<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        
        
        <link rel="shortcut icon" href="../../img/favicon.ico">
        <title>Azure to Heroku - Loop Docs</title>
        <link href="../../css/bootstrap-custom.min.css" rel="stylesheet">
        <link href="../../css/font-awesome.min.css" rel="stylesheet">
        <link href="../../css/base.css" rel="stylesheet">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/docco.min.css">
        <link href="../../css/admonitions.css" rel="stylesheet">
        <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
        <!--[if lt IE 9]>
            <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
            <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
        <![endif]-->

        <script src="../../js/jquery-1.10.2.min.js" defer></script>
        <script src="../../js/bootstrap-3.0.3.min.js" defer></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
        <script>hljs.initHighlightingOnLoad();</script>
        <script>
            (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
            (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
            m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
            })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

            ga('create', 'UA-109876065-1', 'loopkit.github.io');
            ga('send', 'pageview');
        </script> 
    </head>

    <body>

        <div class="navbar navbar-default navbar-fixed-top" role="navigation">
            <div class="container">

                <!-- Collapsed navigation -->
                <div class="navbar-header">
                    <!-- Expander button -->
                    <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                        <span class="sr-only">Toggle navigation</span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                    </button>
                    <a class="navbar-brand" href="../..">Loop Docs</a>
                </div>

                <!-- Expanded navigation -->
                <div class="navbar-collapse collapse">
                        <!-- Main navigation -->
                        <ul class="nav navbar-nav">
                            <li >
                                <a href="../..">Welcome to Loop</a>
                            </li>
                            <li class="dropdown">
                                <a href="#" class="dropdown-toggle" data-toggle="dropdown">Setup <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li >
    <a href="../../setup/overview/">Overview</a>
</li>
                                    
  <li class="dropdown-submenu">
    <a href="#">Requirements</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../setup/requirements/pump/">Insulin Pump</a>
</li>
            
<li >
    <a href="../../setup/requirements/cgm/">CGM</a>
</li>
            
<li >
    <a href="../../setup/requirements/rileylink/">RileyLink</a>
</li>
            
<li >
    <a href="../../setup/requirements/computer/">Computer</a>
</li>
            
<li >
    <a href="../../setup/requirements/iphone/">iPhone</a>
</li>
            
<li >
    <a href="../../setup/requirements/appledev/">Apple Developer</a>
</li>
    </ul>
  </li>
                                    
  <li class="dropdown-submenu">
    <a href="#">Install Loop</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../setup/build/installing/">Building App</a>
</li>
            
<li >
    <a href="../../setup/build/build_errors/">Build Errors</a>
</li>
            
<li >
    <a href="../../setup/build/code_customization/">Code Customization</a>
</li>
    </ul>
  </li>
                                    
  <li class="dropdown-submenu">
    <a href="#">Loop App setup</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../setup/loop-settings/settings/">Loop Settings</a>
</li>
            
<li >
    <a href="../../setup/loop-settings/services/">Loop Services</a>
</li>
            
<li >
    <a href="../../setup/loop-settings/rileylink_menu/">RileyLink menu</a>
</li>
            
<li >
    <a href="../../setup/loop-settings/pump/">Pump Setup</a>
</li>
    </ul>
  </li>
                                    
  <li class="dropdown-submenu">
    <a href="#">Update</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../setup/update/updating/">Updating</a>
</li>
            
<li >
    <a href="../../setup/update/new-version/">New Version Info</a>
</li>
    </ul>
  </li>
                                </ul>
                            </li>
                            <li class="dropdown">
                                <a href="#" class="dropdown-toggle" data-toggle="dropdown">Operation <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li >
    <a href="../../operation/overview/">Loop Displays</a>
</li>
                                    
  <li class="dropdown-submenu">
    <a href="#">How to Use Loop App</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../operation/features/carbs/">Carb Entries</a>
</li>
            
<li >
    <a href="../../operation/features/bolus/">Bolus</a>
</li>
            
<li >
    <a href="../../operation/features/workout/">Workout Targets</a>
</li>
            
<li >
    <a href="../../operation/features/ice/">Using ICE info</a>
</li>
            
<li >
    <a href="../../operation/features/watch/">Apple Watch</a>
</li>
            
<li >
    <a href="../../operation/features/widget/">iPhone widget</a>
</li>
            
<li >
    <a href="../../operation/features/healthapp/">Health App</a>
</li>
            
<li >
    <a href="../../operation/features/notifications/">Loop Notifications</a>
</li>
            
<li >
    <a href="../../operation/features/battery/">Pump Battery</a>
</li>
    </ul>
  </li>
                                    
  <li class="dropdown-submenu">
    <a href="#">Looping Tips</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../operation/loop/open-loop/">Open Loop</a>
</li>
            
<li >
    <a href="../../operation/loop/close-loop/">Closed Loop</a>
</li>
    </ul>
  </li>
                                    
  <li class="dropdown-submenu">
    <a href="#">Algorithm</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../operation/algorithm/overview/">Overview</a>
</li>
            
<li >
    <a href="../../operation/algorithm/bolus/">Bolus Recommendations</a>
</li>
            
<li >
    <a href="../../operation/algorithm/prediction/">Glucose Prediction</a>
</li>
            
<li >
    <a href="../../operation/algorithm/temp_basal/">Temp Basal Adjustments</a>
</li>
    </ul>
  </li>
                                </ul>
                            </li>
                            <li class="dropdown">
                                <a href="#" class="dropdown-toggle" data-toggle="dropdown">Troubleshooting <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li >
    <a href="../../troubleshooting/overview/">Overview</a>
</li>
                                    
<li >
    <a href="../../troubleshooting/green-loop/">Grey Loop</a>
</li>
                                    
<li >
    <a href="../../troubleshooting/yellow-red-loop/">Yellow/Red Loop</a>
</li>
                                    
<li >
    <a href="../../troubleshooting/mlab_cleanup/">NS display</a>
</li>
                                    
<li >
    <a href="../../troubleshooting/priming/">Priming and Sites</a>
</li>
                                    
<li >
    <a href="../../troubleshooting/rileylink/">RileyLink</a>
</li>
                                    
<li >
    <a href="../../troubleshooting/time-change/">Time Changes</a>
</li>
                                    
<li >
    <a href="../../troubleshooting/pump-errors/">Pump Errors</a>
</li>
                                </ul>
                            </li>
                            <li class="dropdown active">
                                <a href="#" class="dropdown-toggle" data-toggle="dropdown">Nightscout <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li >
    <a href="../overview/">Overview</a>
</li>
                                    
<li >
    <a href="../new_user/">Setup New Site</a>
</li>
                                    
<li >
    <a href="../update_user/">Update Site</a>
</li>
                                    
<li class="active">
    <a href="./">Azure to Heroku</a>
</li>
                                    
<li >
    <a href="../loop_pill/">Loop Pill</a>
</li>
                                    
<li >
    <a href="../ifttt/">IFTTT</a>
</li>
                                    
<li >
    <a href="../pebble/">Pebble</a>
</li>
                                    
<li >
    <a href="../pushover/">Remote Notifications</a>
</li>
                                    
<li >
    <a href="../reports/">Reports</a>
</li>
                                </ul>
                            </li>
                        </ul>

                    <ul class="nav navbar-nav navbar-right">
                        <li>
                            <a href="#" data-toggle="modal" data-target="#mkdocs_search_modal">
                                <i class="fa fa-search"></i> Search
                            </a>
                        </li>
                            <li >
                                <a rel="next" href="../update_user/">
                                    <i class="fa fa-arrow-left"></i> Previous
                                </a>
                            </li>
                            <li >
                                <a rel="prev" href="../loop_pill/">
                                    Next <i class="fa fa-arrow-right"></i>
                                </a>
                            </li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="container">
                <div class="col-md-3"><div class="bs-sidebar hidden-print affix well" role="complementary">
    <ul class="nav bs-sidenav">
        <li class="main active"><a href="#migrating-from-azure-to-heroku">Migrating from Azure to Heroku</a></li>
            <li><a href="#updating-your-repository-in-github">Updating your repository in GitHub</a></li>
            <li><a href="#heroku-nightscout-site-setup">Heroku Nightscout Site Setup</a></li>
            <li><a href="#migrate-mlab-database">Migrate mLab database</a></li>
            <li><a href="#event-history">EVENT HISTORY</a></li>
    </ul>
</div></div>
                <div class="col-md-9" role="main">

<h1 id="migrating-from-azure-to-heroku">Migrating from Azure to Heroku<a class="headerlink" href="#migrating-from-azure-to-heroku" title="Permanent link">⌁</a></h1>
<p>If you are a current Azure user who wants to move to Heroku, but not lose all your old NS data, you will need do the following steps:</p>
<ul>
<li>update your repository in GitHub</li>
<li>create a new heroku nightscout site</li>
<li>migrate your mLab database to new site</li>
</ul>
<h2 id="updating-your-repository-in-github">Updating your repository in GitHub<a class="headerlink" href="#updating-your-repository-in-github" title="Permanent link">⌁</a></h2>
<ul>
<li>Copy, paste, and goto the one of the following links depending on which branch of cgm-remote-monitor you are currently running (replace <code>yourgithubname</code> with your actual GitHub user name)</li>
</ul>
<p>for <strong>master</strong> branch deployments:</p>
<p><code>https://github.com/yourgithubname/cgm-remote-monitor/compare/master...nightscout:master</code></p>
<p>For <strong>dev</strong> branch deployments:</p>
<p><code>https://github.com/yourgithubname/cgm-remote-monitor/compare/dev...nightscout:dev</code></p>
<p align="center">
<img src="../img/compare_repo.jpg" width="450">
</p>

<ul>
<li>Click the big green <code>Create pull request</code> button. Another screen will appear, fill in a title and click button to create the pull request, and then you can <code>Merge pull request</code>, and finally <code>Confirm merge</code>.</li>
</ul>
<hr />
<p><p align="center">
<img src="../img/update1.jpg" width="450">
</p> </p>
<hr />
<p><p align="center">
<img src="../img/update2.jpg" width="550">
</p> </p>
<hr />
<p><p align="center">
<img src="../img/update3.jpg" width="550">
</p> </p>
<hr />
<ul>
<li>Your cgm-remote-monitor repository is now up-to-date.  Nice work.</li>
</ul>
<h2 id="heroku-nightscout-site-setup">Heroku Nightscout Site Setup<a class="headerlink" href="#heroku-nightscout-site-setup" title="Permanent link">⌁</a></h2>
<ul>
<li>Create an account at <a href="https://www.heroku.com">Heroku</a> and choose the Primary Development Language to be Node.js when you create your account.  You’re going to use a free account, but you will still need to enter credit card information for your account setup.  Don’t forget to check your email to confirm your Heroku account.</li>
</ul>
<p align="center">
<img src="../img/heroku_signup.jpg" width="450">
</p>

<ul>
<li>
<p>Go to your Nightscout cgm-remote-monitor repository in GitHub (https://github.com/yourGitHubname/cgm-remote-monitor)</p>
</li>
<li>
<p>Scroll down until you see the purple <code>Deploy to Heroku</code> button.  Click that button.</p>
</li>
</ul>
<p align="center">
<img src="../img/deploy_heroku.jpg" width="450">
</p>

<ul>
<li>
<p>Give your app a name, this will be the prefix of your NS site’s URL. For example, <code>https://yourappname.herokuapp.com</code></p>
</li>
<li>
<p>Fill out the information lines in the <code>Config Variables</code> Section of that page, as shown below.  Some of the lines can stay with the default entries already provided.</p>
</li>
</ul>
<table>
<thead>
<tr>
<th>KEY</th>
<th>VALUE</th>
</tr>
</thead>
<tbody>
<tr>
<th>API_SECRET</th>
<td>Create your own API_SECRET…this is like the password to your NS site.  Please write it down somewhere safe or commit it to memory, you will be using it in the future.  It needs to be at least 12 characters long and should NOT use the `@` symbol.</td>
</tr>
<tr>
<th>DISPLAY_UNITS</th>
<td>enter either mg/dl or mmol</td>
</tr>
<tr>
<th>ENABLE</th>
<td>bridge loop pump iob cob basal careportal sage cage</br></br>(Enter all of the words without commas.  Just a single space between each word. Make sure autocorrect does not add space between careportal)</td>
</tr>
<tr>
<th>DISABLE</th>
<td>Leave blank</td>
</tr>
<tr>
<th>ALARM_TYPES</th>
<td>simple</td>
</tr>
<tr>
<th>BG_HIGH</th>
<td>Enter the numeric value of BG you’d like as an urgent high alarm.</td>
</tr>
<tr>
<th>BG_TARGET_TOP</th>
<td>Enter the numeric value of the top of your target BG.</td>
</tr>
<tr>
<th>BG_TARGET_BOTTOM</th>
<td>Enter the numeric value of the bottom of your target BG.</td>
</tr>
<tr>
<th>BG_LOW</th>
<td>Enter the numeric value of the BG you’d like as an urgent low alarm.</td>
</tr>
<tr>
<th>PUSHOVER lines</th>
<td>Can be left blank for now.   See PUSHOVER section if you want to integrate PUSHOVER notifications with NS later.</td>
</tr>
<tr>
<th>CUSTOM_TITLE</th>
<td>This will be the text displayed in the upper left part of the NS website.</td>
</tr>
<tr>
<th>THEME</th>
<td>change from default to colors</td>
</tr>
<tr>
<th>BRIDGE_USER_NAME</th>
<td>Enter your Dexcom Share Account login name.  This should be the same account name used in the Share2 or G5 Mobile app.</td>
</tr>
<tr>
<th>BRIDGE_PASSWORD</th>
<td>Enter your Dexcom Share Account password.</td>
</tr>
<tr>
<th>BG_TARGET TOP</th>
<td>Enter the numeric value of the top of your target BG.</td>
</tr>
<tr>
<th>BG_TARGET_BOTTOM</th>
<td>Enter the numeric value of the bottom of your target BG.</td>
</tr>
</tbody>
</table>

<p><strong>The remaining variables can be left at their default values.</strong></br></br></p>
<ul>
<li>Click the purple <code>Deploy</code> button at the bottom of screen</li>
</ul>
<p align="center">
<img src="../img/deploy_button.jpg" width="450">
</p>

<ul>
<li>Wait a little bit while Heroku builds your NS app.  You’ll see some text scroll by in the Build App box, and then finally, you will have a message that the NS app was successfully deployed.</li>
</ul>
<p align="center">
<img src="../img/deploy_success.jpg" width="450">
</p>

<ul>
<li>You can verify your site’s successful build by clicking <code>View</code> (you should see black site with a profile warning).  You will be redirected to a profile set-up page.  (If it doesn't redirect automatically, refresh your webpage).  </li>
</ul>
<p align="center">
<img src="../img/no_profile.jpg" width="450">
</p>

<p>You do not have to enter all the information in the profile if you are using Loop (since Loop will be providing the information for IOB and COB rather than letting NS calculate them), but you do have to fill out the <code>Basal Profile</code> and <code>TimeZone</code> at a minimum in order to have your temp basals properly display.  Click <code>Save</code> when you have entered the information.  You will be prompted to authenticate, if it is the first time you’ve used the device to make changes in your profile.  Click on the <code>Authenticate</code> link at the bottom of the site, and enter your API_SECRET to complete the authentication.</p>
<p align="center">
<img src="../img/profile.jpg" width="450">
</p>

<ul>
<li>Assuming your previous browser tab is still open for "Create a new App | Heroku", let's go back to that tab.  This time instead of choosing the <code>View</code> option, we are going to select the <code>Manage App</code> button. Then, select the <code>Settings</code> tab near the top of the screen on your Heroku app.</li>
</ul>
<p align="center">
<img src="../img/settings_heroku.jpg" width="450">
</p>

<ul>
<li>Click on <code>Reveal Config  Vars</code>. Scroll down the bottom of the Config Vars lines until you find the last blank one.  You are going to add several additional lines of config vars for Loop use; the DEVICESTATUS_ADVANCED is a required line, the others just make Nightscout more useful when Looping.</li>
</ul>
<p align="center">
<img src="../img/add_vars.jpg" width="450">
</p>

<table>
<thead>
<tr>
<th>KEY</th>
<th>VALUE</th>
</tr>
</thead>
<tbody>
<tr>
<th>DEVICESTATUS_ADVANCED</th>
<td>true</td>
</tr>
<tr>
<th>PUMP_FIELDS</th>
<td>battery reservoir clock status</td>
</tr>
<tr>
<th>PUMP_RETRO_FIELDS</th>
<td>battery reservoir clock status</td>
</tr>
<tr>
<th>SHOW_FORECAST</th>
<td>loop</td>
</tr>
<tr>
<th>SHOW_PLUGINS</th>
<td>loop pump cob iob sage cage careportal</td>
</tr>
<tr>
<th>PUMP_ENABLE_ALERTS</th>
<td>true</td>
</tr>
<tr>
<th>PUMP_URGENT_BATT_U</th>
<td>30</br></br>(This is the pump battery percentage that will trigger a red, urgent alert in NS.)</td>
</tr>
<tr>
<th>PUMP_URGENT_BATT_V</th>
<td>1.25</br></br>(This is the pump battery voltage that will trigger a red, urgent alert in NS.)</td>
</tr>
<tr>
<th>PUMP_URGENT_RES</th>
<td>10</br></br>(This is the reservoir volume that will trigger a red, urgent alert in NS.)</td>
</tr>
<tr>
<th>PUMP_URGENT_CLOCK</th>
<td>30</td>
</tr>
<tr>
<th>LOOP_ENABLE_ALERTS</th>
<td>true</td>
</tr>
<tr>
<th>LOOP_WARN</th>
<td>20</br></br>(This is the minutes since Loop last successfully looped, the t1d will have a similar notification at this time through the Loop app.  This will be a yellow alert in NS.)</td>
</tr>
<tr>
<th>LOOP_URGENT</th>
<td>60</br></br>(Same as the alert above, but will be red in color and have a shorter snooze option.)</td>
</tr>
</tbody>
</table>

<p>The remaining variables can be left at their default values.</br></br></p>
<ul>
<li>Click on <code>Open App</code> in the top right corner of your Heroku site.</li>
</ul>
<p align="center">
<img src="../img/open_app.jpg" width="450">
</p>

<ul>
<li>Click on the settings (those three horizontal lines in upper right corner).  Now check that your basal render is selected to either default or icicle (personal preference for how the temp basals show as blue lines in NS site), check the boxes that you’d like display pills in the SHOW PLUGINS (usually all of them), and then press save. Your new Nightscout site is all set-up.  Congrats!</li>
</ul>
<p align="center">
<img src="../img/settings_ns.jpg" width="450">
</p>

<h2 id="migrate-mlab-database">Migrate mLab database<a class="headerlink" href="#migrate-mlab-database" title="Permanent link">⌁</a></h2>
<p>If you’d like to seamlessly keep all your old Azure NS data showing in your new Heroku NS site, you’ll need to copy and paste your old <code>MONGODB</code> string from your Azure site.  Find it in either Application Settings or Connection strings in your Azure control panel and then go to Heroku’s <code>MONGODB_URI</code> line.  Replace the content with your copied string from Azure.  Double check that your Azure collection used the “entries” name…if it doesn’t, then you will need to update that variable in Heroku to match as well.</p>
<p align="center">
<img src="../img/mongo.jpg" width="450">
</p>

<h2 id="event-history">EVENT HISTORY<a class="headerlink" href="#event-history" title="Permanent link">⌁</a></h2>
<p>Don't forget to keep you Loop App's Preferred Source set to <code>Event History</code> if you want your NS site to smoothly integrate.  Preferred Source set to <code>Reservoir</code> will result in carbs not being uploaded and temp basals not being displayed.</p></div>
        </div>

        <footer class="col-md-12">
            <hr>
            <p>Documentation built with <a href="https://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>
        <script>
            var base_url = "../..",
                shortcuts = {"help": 191, "next": 78, "previous": 80, "search": 83};
        </script>
        <script src="../../js/base.js" defer></script>
        <script src="../../search/main.js" defer></script>

        <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="Search Modal" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                <h4 class="modal-title" id="exampleModalLabel">Search</h4>
            </div>
            <div class="modal-body">
                <p>
                    From here you can search these documents. Enter
                    your search terms below.
                </p>
                <form role="form">
                    <div class="form-group">
                        <input type="text" class="form-control" placeholder="Search..." id="mkdocs-search-query" title="Type search term here">
                    </div>
                </form>
                <div id="mkdocs-search-results"></div>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div><div class="modal" id="mkdocs_keyboard_modal" tabindex="-1" role="dialog" aria-labelledby="Keyboard Shortcuts Modal" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                <h4 class="modal-title" id="exampleModalLabel">Keyboard Shortcuts</h4>
            </div>
            <div class="modal-body">
              <table class="table">
                <thead>
                  <tr>
                    <th style="width: 20%;">Keys</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td class="help shortcut"><kbd>?</kbd></td>
                    <td>Open this help</td>
                  </tr>
                  <tr>
                    <td class="next shortcut"><kbd>n</kbd></td>
                    <td>Next page</td>
                  </tr>
                  <tr>
                    <td class="prev shortcut"><kbd>p</kbd></td>
                    <td>Previous page</td>
                  </tr>
                  <tr>
                    <td class="search shortcut"><kbd>s</kbd></td>
                    <td>Search</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>

    </body>
</html>
